function userChart(a,e,t){xAxisNameMoved=!1,isUserData=!0,firstUpdate=!1,updateCount=0,input_data=[],input_data_selected=[],input_data_donut=[],chr_index_list=[],main_graph_chk=1,input_data_option="low",$("#pieChart_svg").empty(),$("#controller").empty(),$("#chr_label").empty(),$("#multiBarChart").empty(),$("#focusChart_svg").empty(),$("#controller").append("<li id='datatype'> The data is uploaded from <b>"+e+"</b></li>"),$("#controller").append("<li id='upfilename'> File name: <b>"+t+"</b></li>");var n=d3.tsv.parse(a);test.data_raw="",test.data_raw=n;Object.keys(n[0]);window.y1=n[0].sample_1;n[0].sample_2;gen_dataSet(n)}function initPicker(){window.picker=new FilePicker({apiKey:"AIzaSyAc6hbd-Sq_YQ6CkviWXtQslAw4yC-PIB4",clientId:"639017132977-7e7o9ikbrmklj157qdc5rc2qs2ajd088.apps.googleusercontent.com",buttonEl:document.getElementById("googledrive_chooser"),onSelect:function(a){var e=a.title;downloadFile(a,e)}})}function downloadFile(a,e,t){if(a.downloadUrl){var n=gapi.auth.getToken().access_token,l=new XMLHttpRequest;l.open("GET",a.downloadUrl),l.setRequestHeader("Authorization","Bearer "+n),l.onload=function(){var a="Google Drive";userChart(l.response,a,e)},l.onerror=function(){t(null)},l.send()}else t(null)}function gen_dataSet(a){chr_index_list=[],obj.data_valid=[];for(var e=0;e<a.length;e++)"OK"!==a[e].status||"yes"!==a[e].significant||isNaN(a[e]["log2(fold_change)"])||obj.data_valid.push(a[e]);test.data_valid=obj.data_valid,window.sample_1={},window.sample_2={},window.log2={},sample_1.key=obj.data_valid[0].sample_1,sample_2.key=obj.data_valid[0].sample_2,log2.key="log2(fold_change)",sample_1.area="false",sample_2.area="false",log2.area="false",sample_1.values=new Array,sample_2.values=new Array,log2.values=new Array;for(var t={},n={},l={},o=0;o<obj.data_valid.length;o++){t={},n={},l={};var d=obj.data_valid[o].locus.split(":"),i=d[0];t.y=parseInt(obj.data_valid[o].value_1),t.x=o,t.val=obj.data_valid[o].value_1,t.chr=i,t.gene=obj.data_valid[o].gene,t.p_val=parseFloat(obj.data_valid[o].p_value),n.y=parseInt(obj.data_valid[o].value_2),n.x=o,n.val=obj.data_valid[o].value_2,n.chr=i,n.gene=obj.data_valid[o].gene,n.p_val=parseFloat(obj.data_valid[o].p_value);var r=parseFloat(obj.data_valid[o]["log2(fold_change)"]).toFixed(1);0>r?l.y=parseInt(obj.data_valid[o]["log2(fold_change)"]):l.y=parseFloat(obj.data_valid[o]["log2(fold_change)"]).toFixed(1),l.x=o,l.val=obj.data_valid[o]["log2(fold_change)"],l.chr=i,l.gene=obj.data_valid[o].gene,l.p_val=parseFloat(obj.data_valid[o].p_value),sample_1.values.push(t),sample_2.values.push(n),log2.values.push(l)}input_data.push(sample_1),input_data.push(sample_2),input_data.push(log2),window.input_data_ready="true",window.chr_counter={};for(var _="null",u={},s=0;s<sample_1.values.length;s++){chr_counter[sample_1.values[s].chr]=(chr_counter[sample_1.values[s].chr]||0)+1;var i=sample_1.values[s].chr;(_!=i||s==sample_1.values.length-1)&&(console.log("unmatched name"),s>0&&chr_index_list.push(u),u={},u.name=i,u.idx=new Array,_=i),u.idx.push(s)}for(var p in chr_counter){var c={};c.key=p,c.count=chr_counter[p],input_data_donut.push(c)}"undefined"==typeof donut_count&&(window.donut_data={}),donut_data.total=0;for(var e=0;e<input_data_donut.length;e++)donut_data.total+=input_data_donut[e].count;donut_data.chrNum=input_data_donut.length;var v="all";gen_graph(input_data,v)}function gen_graph(a,e){if("all"===e){nv.addGraph({generate:function(){var a=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return a.count}).donut(!0).padAngle(.02).cornerRadius(3);return a.title("CuffDiff"),a.pie.donutLabelsOutside(!0).donut(!0),d3.select("#pieChart svg").datum(input_data_donut).transition().duration(1200).call(a),a}})}}function gen_custom_dataset(a){window.pie_click2=a,main_graph_chk=0,$("#chr_label").empty(),$("#chr_label").append("<li>Selected: <b>"+a.label+"</b></li>"),$("#chr_label").append('<a href="/BioITCore/DifferentialExpression.html" target="_blank"> Move to full version of this visualization</a>')}function gen_user_pval_dataset(a){console.log("pv: "+a),window.new_values_index=[],"undefined"==typeof input_data_pval_filtered&&(window.input_data_pval_filtered=[]),1==main_graph_chk?(dataset=input_data,input_data_pval_filtered=$.extend(!0,[],input_data)):(dataset=input_data_selected,input_data_pval_filtered=$.extend(!0,[],input_data)),console.log("dataset size: "+dataset[0].values.length);for(var e=0;e<dataset[2].values.length;e++)(dataset[2].values[e].p_val<a||dataset[2].values[e].p_val==a)&&new_values_index.push(e);for(var t=0;t<input_data_pval_filtered.length;t++)input_data_pval_filtered[t].values.length=0;for(var n=0;n<dataset.length;n++)for(var l=0;l<new_values_index.length;l++)input_data_pval_filtered[n].values.push(dataset[n].values[new_values_index[l]]);gen_graph(input_data_pval_filtered)}$(document).ready(function(){window.test={},window.obj={},window.input_data=[],window.input_data_selected=[],window.input_data_donut=[],window.chr_index_list=[],window.choice_list=[],window.input_data_option="low";window.main_graph_chk=1;var a=Dropbox.createChooseButton(options);document.getElementById("dropbox_chooser").appendChild(a),$("#localdrive_btn_wrapper").click(function(){$("#selectfile_local").trigger("click")}),$("#p_value_input").keyup(function(a){13==a.keyCode&&$("#update_btn").click()}),$("#selectfile_local").change(function(a){var e=document.getElementById("selectfile_local").files[0];window.reader=new FileReader;var t=e.name,n="Local Drive";reader.onload=function(a){userChart(reader.result,n,t)},reader.readAsText(e)}),d3.tsv("Galaxy5_clean.tabular",function(a,e){gen_dataSet(e)})}),Array.prototype.unique=function(){var a,e={},t=this.length,n=[];for(a=0;t>a;a+=1)e[this[a]]=this[a];for(a in e)n.push(e[a]);return n};var options={success:function(a){var e=new XMLHttpRequest;e.open("GET",a[0].link),e.send(),e.onload=function(){var a="Dropbox",t=e.responseURL,n=t.split("/"),l=n[n.length-1];userChart(e.response,a,l)}},cancel:function(){},linkType:"direct",multiselect:!1};$("#update_btn").on("click",function(){var a=$("#p_value_input").val(),e=parseFloat(a);gen_user_pval_dataset(e)});
