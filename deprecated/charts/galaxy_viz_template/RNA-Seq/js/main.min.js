function userChart(a,t,e){xAxisNameMoved=!1,isUserData=!0,firstUpdate=!1,updateCount=0,input_data=[],input_data_selected=[],input_data_donut=[],chr_index_list=[],main_graph_chk=1,input_data_option="low",$("#pieChart_svg").empty(),$("#controller").empty(),$("#chr_label").empty(),$("#filter_info").empty(),$("#multiBarChart").empty(),$("#focusChart_svg").empty(),$("#controller").append("<li id='datatype'> The data is uploaded from <b>"+t+"</b></li>"),$("#controller").append("<li id='upfilename'> File name: <b>"+e+"</b></li>");var l=d3.tsv.parse(a);test.data_raw="",test.data_raw=l;Object.keys(l[0]);window.y1=l[0].sample_1;l[0].sample_2;gen_dataSet(l)}function gen_dataSet(a){chr_index_list=[],obj.data_valid=[];for(var t=0;t<a.length;t++)"OK"!==a[t].status||"yes"!==a[t].significant||isNaN(a[t]["log2(fold_change)"])||obj.data_valid.push(a[t]);test.data_valid=obj.data_valid,window.sample_1={},window.sample_2={},window.log2={},sample_1.key=obj.data_valid[0].sample_1,sample_2.key=obj.data_valid[0].sample_2,log2.key="log2(fold_change)",sample_1.area="false",sample_2.area="false",log2.area="false",sample_1.values=new Array,sample_2.values=new Array,log2.values=new Array;for(var e={},l={},n={},d=0;d<obj.data_valid.length;d++){e={},l={},n={};var _=obj.data_valid[d].locus.split(":"),i=_[0];e.y=parseInt(obj.data_valid[d].value_1),e.x=d,e.val=obj.data_valid[d].value_1,e.chr=i,e.gene=obj.data_valid[d].gene,e.p_val=parseFloat(obj.data_valid[d].p_value),l.y=parseInt(obj.data_valid[d].value_2),l.x=d,l.val=obj.data_valid[d].value_2,l.chr=i,l.gene=obj.data_valid[d].gene,l.p_val=parseFloat(obj.data_valid[d].p_value);var o=parseFloat(obj.data_valid[d]["log2(fold_change)"]).toFixed(1);0>o?n.y=parseInt(obj.data_valid[d]["log2(fold_change)"]):n.y=parseFloat(obj.data_valid[d]["log2(fold_change)"]).toFixed(1),n.x=d,n.val=obj.data_valid[d]["log2(fold_change)"],n.chr=i,n.gene=obj.data_valid[d].gene,n.p_val=parseFloat(obj.data_valid[d].p_value),sample_1.values.push(e),sample_2.values.push(l),log2.values.push(n)}input_data.push(sample_1),input_data.push(sample_2),input_data.push(log2),window.input_data_ready="true",window.chr_counter={};for(var r="null",u={},s=0;s<sample_1.values.length;s++){chr_counter[sample_1.values[s].chr]=(chr_counter[sample_1.values[s].chr]||0)+1;var i=sample_1.values[s].chr;(r!=i||s==sample_1.values.length-1)&&(s>0&&chr_index_list.push(u),u={},u.name=i,u.idx=new Array,r=i),u.idx.push(s)}for(var p in chr_counter){var v={};v.key=p,v.count=chr_counter[p],input_data_donut.push(v)}"undefined"==typeof donut_count&&(window.donut_data={}),donut_data.total=0;for(var t=0;t<input_data_donut.length;t++)donut_data.total+=input_data_donut[t].count;donut_data.chrNum=input_data_donut.length;var c="all";gen_graph(input_data,c)}function gen_graph(a,t){if(nv.addGraph(function(){return window.fchart=nv.models.lineWithFocusChart(),fchart.brushExtent([50,70]),fchart.xAxis.tickFormat(d3.format(",f")),fchart.x2Axis.tickFormat(d3.format(",f")),fchart.yAxis.tickFormat(d3.format(",.f")),fchart.y2Axis.tickFormat(d3.format(",f")),fchart.isArea(!1),fchart.height(700),fchart.color(["#29A329","#FF8080","#4775FF"]),d3.select("#focusChart_svg").datum(a).call(fchart),fchart}),"all"===t){nv.addGraph({generate:function(){var a=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return a.count}).donut(!0).padAngle(.02).cornerRadius(3);return a.title("CuffDiff"),a.pie.donutLabelsOutside(!0).donut(!0),d3.select("#pieChart svg").datum(input_data_donut).transition().duration(1200).call(a),a}})}}function gen_custom_dataset(a){window.pie_click2=a,main_graph_chk=0,$("#chr_label").empty(),$("#filter_info").empty(),$("#chr_label").append("<li>Selected: <b>"+a.label+"</b></li>"),input_data_selected=[];var t={},e={},l={};t.key=sample_1.key,e.key=sample_2.key,l.key=log2.key,t.nonStackable=sample_1.nonStackable,e.nonStackable=sample_2.nonStackable,l.nonStackable=log2.nonStackable,t.values=new Array,e.values=new Array,l.values=new Array,console.log(a.label);for(var n=0;n<chr_index_list.length;n++)if(a.label===chr_index_list[n].name)for(var d=0;d<chr_index_list[n].idx.length;d++)t.values.push(input_data[0].values[chr_index_list[n].idx[d]]),e.values.push(input_data[1].values[chr_index_list[n].idx[d]]),l.values.push(input_data[2].values[chr_index_list[n].idx[d]]);input_data_selected.push(t),input_data_selected.push(e),input_data_selected.push(l),gen_graph(input_data_selected)}function gen_user_pval_dataset(a){console.log("pv: "+a),window.new_values_index=[],"undefined"==typeof input_data_pval_filtered&&(window.input_data_pval_filtered=[]),1==main_graph_chk?(dataset=input_data,input_data_pval_filtered=$.extend(!0,[],input_data)):(dataset=input_data_selected,input_data_pval_filtered=$.extend(!0,[],input_data)),console.log("dataset size: "+dataset[0].values.length);for(var t=0;t<dataset[2].values.length;t++)(dataset[2].values[t].p_val<a||dataset[2].values[t].p_val==a)&&new_values_index.push(t);for(var e=0;e<input_data_pval_filtered.length;e++)input_data_pval_filtered[e].values.length=0;for(var l=0;l<dataset.length;l++)for(var n=0;n<new_values_index.length;n++)input_data_pval_filtered[l].values.push(dataset[l].values[new_values_index[n]]);gen_graph(input_data_pval_filtered)}$(document).ready(function(){window.test={},window.obj={},window.input_data=[],window.input_data_selected=[],window.input_data_donut=[],window.chr_index_list=[],window.choice_list=[],window.input_data_option="low";window.main_graph_chk=1,$("#p_value_input").keyup(function(a){13==a.keyCode&&$("#update_btn").click()});var a=d3.tsv.parse(inputFile);gen_dataSet(a)}),Array.prototype.unique=function(){var a,t={},e=this.length,l=[];for(a=0;e>a;a+=1)t[this[a]]=this[a];for(a in t)l.push(t[a]);return l},$("#update_btn").on("click",function(){var a=$("#p_value_input").val(),t=parseFloat(a);gen_user_pval_dataset(t),$("#filter_info").empty(),$("#filter_info").append("<li>Filtered p-value by <b>"+a+"</b></li>")});
