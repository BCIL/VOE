<html>
  <head>
    <title> XML to JSON converter </title>
    
    <script type="text/javascript" src="js/jkl-dumper.js" charset="Shift_JIS"></script>
    <script type="text/javascript" src="js/jkl-parsexml.js"></script>
    <script type="text/javascript" src="js/loadxmldoc.js"></script> 
    <script type="text/javascript" src="js/expandCollapse.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/upclick.js"></script>

    <meta charset = "utf-8">

    <style type="text/css">
        body {
            background-color: lightgrey;
        }
    </style>
    </head>
  
  <body>
        <h1 id="title" align="center"> XML to JSON parser - ver. 3.1 </h1>
        <h4 > Usage: </h4>
        <div id="usage" style="display:none">
            <ul>
                <li> Firstly, You need to upload your phyloXML file from the local drive. Click the upload button then select the file. </li>
                <li> After uploading, you can generate two types (Radial and Indented Tree) of tree of the uploaded file.</li>
                <li> You don't need to re-upload the same file for generating different type of tree. </li>
            </ul>
        </div>
        <div>

        <input id ="usageButton" type="button" value="+Show Usage" onclick="return toggleMe('usage');document.getElementById('usageButton').style.color='blue';">
        </div> <br />

        <h3 style="text-align: left" align="center"> - Upload phyloxml file - </h3>
        <input type="button" id="uploader" value="Upload your phyloXML file">

        <h3 style="text-align: left" align="center"> - Generate phyloxml tree - </h3>
        <input type="submit" id="gen_Radial" value="Generate Radial Tree">
        <input type="submit" id="gen_Indented" value="Generate Indented Tree" >
        <input type="submit" id="gen_Sunburst" value="Generate Sunburst" >
        <output id="upFileDetail" style="padding: 4px;"> </output><br />
    
    
    <script type="text/javascript">

        var chk_modify = false;
        var chk_parsing = false;
        var fin;
        var newText; // stores parsed JSON data

        /*
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object
            var output = [];            
            for (var i = 0, f; f = files[i]; i++) {
                output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ', f.size, ' bytes, last modified: ', f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a', '</li>');

                filename = f.name;  // get filename
            }
            document.getElementById('listName').innerHTML = filename;
            document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
        }
        
        // select user file from the user local drive
        document.getElementById('file').addEventListener('change', handleFileSelect, false);
        */

        // Uploader works with upclick.js
        var uploader = document.getElementById('uploader');
        upclick 
        ({
            element: uploader,
            action: 'uploadFile.php', 
            onstart:
                function(filename) {
                    console.log('Start upload: '+ filename);
                },
            oncomplete:
                function(response_data) {
                    console.log("PHP returned : " + response_data);
                    fin = response_data;
                    chk_upFile();
                    /*
                    fin = response_data;
                    var output = [];
                    output = fin;
                    document.getElementById(#warnMSG).innerHTML = output.join('');
                    */
                }
        });

        function chk_upFile() {
            console.log("chk_upFile");
            //document.getElementById('uploader').addEventListener('change', handleFileSelect, false);
            document.getElementById('upFileDetail').innerHTML = "<br><br><strong> '" + fin + "' has been successfully uploaded!"+ "</strong>";
        }

        /*
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object
            var output = [];            
            for (var i = 0, f; f = files[i]; i++) {
                output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ', f.size, ' bytes, last modified: ', f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a', '</li>');

                filename = f.name;  // get filename
            }
            //document.getElementById('listName').innerHTML = filename;
            document.getElementById('upFileDetail').innerHTML = '<ul>' + output.join('') + '</ul>';
        }
        */

        $(function () {
            $("#gen_Radial").bind("click", function () {
                console.log("CALLED - click()")
                window.fin = fin;
                window.open('Radial_Tree_Collapsible_ver3.0.php', '');
            });
        });
        
        $(function () {
            $("#gen_Indented").bind("click", function () {
                console.log("CALLED - click()")
                window.fin = fin;
                window.open('Collapsible_Indented_Tree_ver1.2.php', '');
            });
        });

         $(function () {
            $("#gen_Sunburst").bind("click", function () {
                console.log("CALLED - click()")
                window.fin = fin;
                window.open('Sunburst_ver1.5.php', '');
            });
        });


            
    </script>

</html>
