<html>
  <head>
    <title> XML to JSON converter </title>
    
    <script type="text/javascript" src="js/jkl-dumper.js" charset="Shift_JIS"></script>
    <script type="text/javascript" src="js/jkl-parsexml.js"></script>
    <script type="text/javascript" src="js/loadxmldoc.js"></script> 
    
    <meta charset = "utf-8">
    
    </head>
  
  <body>
        <input type="file" id="files" name="files[]"  />
        <output id="list"></output>
        <INPUT TYPE="button" Value="submit" onClick="start();">
        <p id="parsed" style="padding: 4px; background: yellowgreen;">
        </p>  
    
        
    
    <script type="text/javascript">

        var filename;
        function handleFileSelect(evt) {
            var files = evt.target.files; // FileList object

            // files is a FileList of File objects. List some properties.
            // <input type="file" id="files" name="files[]" multiple />    // accept multiple files
            var output = [];            
            for (var i = 0, f; f = files[i]; i++) {
                output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ', f.size, ' bytes, last modified: ', f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a', '</li>');

                filename = f.name;  // s
            }
            document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
        }

        document.getElementById('files').addEventListener('change', handleFileSelect, false);

        function trimmer(infile) {
            xmlDoc=loadXMLDoc("testTree.xml");

            //x=xmlDoc.replace(/<phylo.*$/mg, '');

            //XDocument xdoc = XDocument.Parse(str);
            /*
            var child = xmlDoc.Descendants("phylogeny");
            XElement root = new XElement("phyloxml");
            root.Add(child);
            XDocument xdoc1 = new XDocument(root);
            
            xdoc1.Save("childData.xml");

            Console.ReadKey();
            */
        }

        function start() { 
            console.log('call start');
            var url = filename;
            //infile=loadXMLDoc("testTree.xml");
            parser(url); 

        }

        function parser(filename) {
            //var url = filename.inputfile.value + ".xml"
            var url = filename;
            //console.log("infile name: " + url);
            //var loadXML = loadXMLDoc(url);
            //var list = loadXML.getElementsByTagName("phyloxml")
            //console.log("tag: " + list.length);
            //var url = "testTree2.xml";
            var xml = new JKL.ParseXML( url, null );
            xml.setOutputArrayElements( ["clade"] );
            var data = xml.parse();
            
            var dumper = new JKL.Dumper();
            var text = dumper.dump( data );
            document.getElementById( "parsed" ).innerHTML = output(text);
            //alert( "documentElement.nodeName: " + dom.nodeName );
            //document.write( data["items"]["item"]["us_state"] );
            //document.write( data.items.item.us_state );
            
            function output(text) {
                if ( typeof(text) == "undefined" ) return "";
                return text.replace( /&/g, "&amp;" ).replace( /</g, "&lt;" ).replace( />/g, "&gt;" ).replace( /\n/g, "<br>\n" ).replace( / /g, "&nbsp;" );
            }
            //var target = '"rooted": "true"'
            //console.log(target);
            document.body.innerHTML = document.body.innerHTML.replace(/"clade"/g, '"children"');
            document.body.innerHTML = document.body.innerHTML.replace(/"#text"/g, '"text"');
            document.body.innerHTML = document.body.innerHTML.replace(/"rooted"/g, '"name"');
            document.body.innerHTML = document.body.innerHTML.replace(/"true"/g, '"ROOT"');
            //document.body.innerHTML = document.body.innerHTML.replace(/"phylo.*$/mg, '');

            //document.body.innerHTML = document.body.innerHTML.replace(/'"rooted": "true"'/g, '"name": "ROOT"');
        }


            
    </script>

</html>
